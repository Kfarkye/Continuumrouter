{
  "version": "1.1",
  "generated_at": "2025-11-22",
  "last_verified": "2025-11-22",
  "system": {
    "name": "Continuum",
    "description": "Multi-lane AI workspace with DeepThink reasoning engine, multi-modal chat, and vertical-specific features",
    "type": "lanes_based_reasoning_system",
    "primary_domains": ["general_ai_chat", "deepthink_reasoning", "clinical_recruiting", "code_assistance"]
  },
  "constraints": {
    "immutable_tables": [
      "ai_lanes",
      "space_runs",
      "ai_runs",
      "ai_artifacts",
      "ai_run_checks",
      "ai_cache",
      "ai_cost_ledger"
    ],
    "do_not_modify": {
      "deepthink_flow": "planner → evidence → solvers → verifier sequence is production-stable",
      "cost_tracking": "ai_cost_ledger partitioning is production-deployed; do not change partition scheme",
      "rls_policies": "All tables have RLS enabled; never disable RLS",
      "pass_type_enum": "ai_pass_type enum values are: planner, retriever, reranker, solver, verifier_hybrid, verifier_llm",
      "run_status_enum": "run_status enum values are: pending, running, success, error, cancelled"
    },
    "planned_only": {
      "builder_vertical": "Design only - not yet implemented. Do not create migrations or functions for this.",
      "sports_vertical": "Design only - not yet implemented. Do not create migrations or functions for this."
    },
    "migration_policy": "All schema changes require new migration files with timestamp prefix format YYYYMMDD_description.sql. Never modify existing migrations."
  },
  "integration_instructions": {
    "for_bolt_new": "Load this manifest in system context at session start. Treat as source-of-truth for schema, functions, and flows. Always reference this manifest before proposing any architectural changes.",
    "for_gemini": "This manifest defines the lanes-based architecture. Use it to understand: (1) how space_runs orchestrate ai_runs, (2) what tables exist and their relationships, (3) what edge functions are deployed, (4) what constraints cannot be violated. Do not invent tables/functions not present here unless explicitly asked to add new ones.",
    "validation_required": "Before suggesting schema changes, verify the change doesn't conflict with immutable_tables or planned_only verticals. Check constraints section first.",
    "query_patterns": "Reference common_queries section for established data access patterns. Follow these patterns when building new queries."
  },
  "stack": {
    "frontend": {
      "framework": "React 18.3.1 + Vite 5.4.21",
      "language": "TypeScript 5.5.3",
      "styling": "Tailwind CSS 3.4.1",
      "state_management": "React hooks + Context API",
      "ui_libraries": [
        "lucide-react (icons)",
        "framer-motion (animations)",
        "react-hot-toast (notifications)",
        "react-markdown (rendering)",
        "react-syntax-highlighter (code display)",
        "mermaid (diagrams)"
      ]
    },
    "backend": {
      "runtime": "Deno (Supabase Edge Functions)",
      "database": "PostgreSQL (Supabase)",
      "storage": "Supabase Storage",
      "auth": "Supabase Auth"
    }
  },
  "architecture": {
    "paradigm": "lanes",
    "description": "Multi-pass reasoning pipeline where each space_run orchestrates multiple ai_runs (passes) through planner → evidence → parallel solvers → hybrid verifier flow",
    "execution_model": {
      "lane": "Configuration defining a reasoning pipeline",
      "space_run": "Complete job execution (user query → final answer)",
      "ai_run": "Individual pass within space_run (planner, solver, verifier, etc.)",
      "pass_types": [
        "planner - Decomposes query into sub-tasks",
        "retriever - Gathers evidence via RAG",
        "reranker - Scores and filters evidence",
        "solver - Generates candidate solutions (parallel)",
        "verifier_hybrid - Deterministic + LLM verification",
        "verifier_llm - Pure LLM verification"
      ]
    },
    "key_flows": {
      "deepthink_execution": "user_query → space_run created → planner pass → evidence passes → N parallel solver passes → verifier selects winner → final_output",
      "simple_chat": "user_query → ai-chat-router → direct model call → streaming response",
      "lane_selection": "router analyzes query → selects lane (deepthink/simple) → routes to appropriate function"
    }
  },
  "example_lane_config": {
    "name": "deepthink_lane_gemini_v2_1_plus",
    "description": "Production DeepThink lane using Gemini 1.5 Flash for all passes",
    "config_json": {
      "planner": {
        "model": "gemini-1.5-flash-latest",
        "temperature": 0.7,
        "max_tokens": 2000
      },
      "retriever": {
        "enabled": true,
        "max_results": 10
      },
      "solver": {
        "model": "gemini-1.5-flash-latest",
        "temperature": 0.8,
        "candidate_count": 3,
        "max_tokens": 4000
      },
      "verifier": {
        "model": "gemini-1.5-flash-latest",
        "hybrid": true,
        "deterministic_checks": true
      },
      "budget": {
        "max_total_tokens": 50000,
        "cost_cap_usd": 1.0
      }
    }
  },
  "database": {
    "provider": "Supabase PostgreSQL",
    "migrations_path": "supabase/migrations/",
    "schemas": {
      "public": {
        "core_lanes_tables": {
          "ai_lanes": {
            "purpose": "Lane configuration registry (pipeline definitions)",
            "key_columns": ["id", "name", "config_json", "created_at"],
            "notes": "Stores DeepThink lane configs with model choices, timeouts, token caps"
          },
          "space_runs": {
            "purpose": "Complete reasoning job executions from start to finish",
            "key_columns": [
              "id",
              "user_id",
              "lane_id",
              "goal_prompt",
              "status",
              "trace_id",
              "verify_score",
              "residual_risk",
              "final_output",
              "start_time",
              "end_time",
              "total_latency_ms",
              "total_cost_usd",
              "total_tokens"
            ],
            "relationships": {
              "lane_id": "FK to ai_lanes",
              "user_id": "FK to auth.users"
            },
            "status_enum": ["pending", "running", "success", "error", "cancelled"]
          },
          "ai_runs": {
            "purpose": "Individual pass executions (planner, solver, verifier) within a space_run",
            "key_columns": [
              "id",
              "space_run_id",
              "pass_type",
              "model_name",
              "input_data",
              "output_data",
              "pass_candidate",
              "is_winner",
              "cache_hit",
              "latency_ms",
              "execution_params",
              "input_tokens",
              "output_tokens"
            ],
            "relationships": {
              "space_run_id": "FK to space_runs"
            },
            "pass_type_enum": ["planner", "retriever", "reranker", "solver", "verifier_hybrid", "verifier_llm"]
          },
          "ai_artifacts": {
            "purpose": "Evidence, snippets, and references gathered during execution",
            "key_columns": [
              "id",
              "space_run_id",
              "ref_id",
              "source_type",
              "source_uri",
              "snippet_hash",
              "snippet_text",
              "snippet_location",
              "rerank_score"
            ],
            "relationships": {
              "space_run_id": "FK to space_runs"
            },
            "source_types": ["web", "db", "file", "error", "search_result"]
          },
          "ai_run_checks": {
            "purpose": "Verification checks performed on solver outputs",
            "key_columns": [
              "id",
              "verifier_run_id",
              "candidate_run_id",
              "check_name",
              "check_type",
              "status",
              "reasoning"
            ],
            "relationships": {
              "verifier_run_id": "FK to ai_runs (verifier pass)",
              "candidate_run_id": "FK to ai_runs (solver being verified)"
            },
            "check_types": ["deterministic", "llm"],
            "check_statuses": ["pass", "fail", "skip"]
          },
          "ai_cache": {
            "purpose": "Cached pass outputs with TTL for performance optimization",
            "key_columns": [
              "cache_key",
              "pass_type",
              "output_data",
              "usage_metadata",
              "created_at",
              "expires_at"
            ],
            "notes": "SHA-256 hash of input as cache_key, daily cron job purges expired entries"
          },
          "ai_cost_ledger": {
            "purpose": "Detailed cost tracking and billing records (partitioned by month)",
            "key_columns": [
              "id",
              "ai_run_id",
              "user_id",
              "provider",
              "model",
              "input_tokens",
              "output_tokens",
              "cost_usd",
              "created_at"
            ],
            "relationships": {
              "ai_run_id": "FK to ai_runs",
              "user_id": "FK to auth.users"
            },
            "partitioning": "Range partitioned by created_at (monthly), auto-created via pg_cron on 25th at 1 AM UTC"
          }
        },
        "chat_tables": {
          "ai_conversations": {
            "purpose": "Chat sessions/threads",
            "key_columns": ["id", "user_id", "session_id", "title", "created_at", "updated_at", "project_id", "preferred_provider", "mode"],
            "modes": ["chat", "deepthink", "tutorial", "recruiter", "reply_assistant"],
            "notes": "session_id is UUID for frontend tracking, id is database PK. Prefer session_id for lookups from frontend."
          },
          "ai_messages": {
            "purpose": "Individual messages in conversations",
            "key_columns": ["id", "conversation_id", "role", "content", "model", "created_at", "metadata"],
            "roles": ["user", "assistant", "system"],
            "notes": "metadata JSONB field stores provider info, token counts, image IDs, etc."
          }
        },
        "projects_spaces": {
          "projects": {
            "purpose": "Workspaces/clinician spaces",
            "key_columns": ["id", "user_id", "name", "description", "clinician_id", "system_prompt", "created_at", "updated_at"]
          },
          "memory_spaces": {
            "purpose": "Memory storage spaces for context",
            "key_columns": ["id", "user_id", "name", "created_at"]
          },
          "memories": {
            "purpose": "Individual memory entries with embeddings",
            "key_columns": ["id", "space_id", "content", "embedding", "metadata", "created_at"],
            "notes": "embedding is vector type for semantic search"
          }
        },
        "clinical_recruiting": {
          "clinician_profiles": {
            "purpose": "Healthcare clinician profiles",
            "key_columns": ["id", "user_id", "full_name", "email", "phone", "specialty", "license_state", "created_at"]
          },
          "assignments": {
            "purpose": "Clinician assignments to facilities",
            "key_columns": ["id", "clinician_id", "user_id", "facility_name", "start_date", "end_date", "status", "created_at"],
            "status_values": ["active", "completed", "cancelled"]
          },
          "clinician_communication_profiles": {
            "purpose": "Communication preferences for clinicians (extends clinician_profiles)",
            "key_columns": ["id", "clinician_id", "user_id", "communication_style", "notes", "last_contacted", "created_at", "updated_at"],
            "communication_styles": ["warm_friendly", "direct_brief", "professional_formal", "casual_relaxed"],
            "relationships": {
              "clinician_id": "FK to clinician_profiles (unique constraint)"
            }
          },
          "reply_threads": {
            "purpose": "Conversation threads for reply assistant (weekly groupings)",
            "key_columns": ["id", "user_id", "project_id", "title", "created_at", "updated_at"],
            "relationships": {
              "project_id": "FK to projects (nullable)"
            }
          },
          "reply_messages": {
            "purpose": "Individual messages within reply threads",
            "key_columns": ["id", "thread_id", "user_id", "clinician_id", "message_type", "incoming_text", "user_goal", "generated_reply_1", "generated_reply_2", "selected_reply", "metadata", "created_at"],
            "message_types": ["user_input", "ai_response", "system"],
            "relationships": {
              "thread_id": "FK to reply_threads",
              "clinician_id": "FK to clinician_profiles (nullable)"
            }
          },
          "clinician_interactions": {
            "purpose": "Historical log of all interactions with clinicians",
            "key_columns": ["id", "clinician_id", "user_id", "interaction_type", "interaction_summary", "outcome", "created_at"],
            "interaction_types": ["text_reply", "phone_call", "email", "extension_request", "issue_resolution", "other"],
            "relationships": {
              "clinician_id": "FK to clinician_profiles"
            }
          }
        },
        "storage_tables": {
          "uploaded_images": {
            "purpose": "Image attachments with Supabase Storage integration",
            "key_columns": ["id", "user_id", "session_id", "conversation_id", "storage_path", "public_url", "signed_url", "original_filename", "mime_type", "file_size", "created_at"]
          },
          "stored_schemas": {
            "purpose": "Saved data structures/schemas",
            "key_columns": ["id", "user_id", "name", "schema_data", "project_id", "created_at"]
          },
          "design_specs": {
            "purpose": "Design specifications",
            "key_columns": ["id", "user_id", "name", "spec_data", "created_at"]
          },
          "code_snippets": {
            "purpose": "Code snippet library",
            "key_columns": ["id", "user_id", "title", "description", "language", "code", "tags", "created_at"]
          }
        },
        "learning_system": {
          "tutorial_progress": {
            "purpose": "User progress through tutorials",
            "key_columns": ["id", "user_id", "tutorial_id", "completed_steps", "status", "created_at", "updated_at"]
          },
          "learning_exercises": {
            "purpose": "Generated learning exercises",
            "key_columns": ["id", "user_id", "topic", "difficulty", "exercise_data", "created_at"]
          }
        },
        "observability_tables": {
          "request_traces": {
            "purpose": "Distributed tracing for debugging",
            "key_columns": ["id", "trace_id", "parent_span_id", "span_name", "start_time", "end_time", "metadata"],
            "notes": "Created by 20251120204415_create_minimal_tracing_core.sql"
          }
        }
      }
    },
    "relationships_map": {
      "lanes_execution": "ai_lanes → space_runs → ai_runs → ai_artifacts + ai_run_checks",
      "chat_hierarchy": "projects → ai_conversations → ai_messages",
      "memory_hierarchy": "memory_spaces → memories",
      "cost_tracking": "ai_runs → ai_cost_ledger",
      "recruiting_flow": "clinician_profiles → assignments + clinician_communication_profiles + clinician_interactions",
      "reply_flow": "reply_threads → reply_messages (with clinician_id FK)"
    }
  },
  "common_queries": {
    "get_user_space_runs": {
      "description": "Fetch recent DeepThink executions for a user",
      "sql": "SELECT * FROM space_runs WHERE user_id = $1 ORDER BY created_at DESC LIMIT 50"
    },
    "get_run_details": {
      "description": "Get complete space_run with all ai_runs",
      "sql": "SELECT sr.*, json_agg(ar.*) as ai_runs FROM space_runs sr LEFT JOIN ai_runs ar ON ar.space_run_id = sr.id WHERE sr.id = $1 GROUP BY sr.id"
    },
    "get_cost_by_user_last_30_days": {
      "description": "Total USD cost per user in last 30 days",
      "sql": "SELECT user_id, SUM(cost_usd) as total_cost FROM ai_cost_ledger WHERE created_at >= NOW() - INTERVAL '30 days' GROUP BY user_id ORDER BY total_cost DESC"
    },
    "get_conversation_history": {
      "description": "Load messages for a conversation",
      "sql": "SELECT id, role, content, created_at, metadata FROM ai_messages WHERE conversation_id = $1 ORDER BY created_at ASC LIMIT 50"
    },
    "get_conversation_by_session": {
      "description": "Find conversation by frontend session_id",
      "sql": "SELECT id, session_id, title FROM ai_conversations WHERE session_id = $1 AND user_id = $2"
    },
    "search_clinicians": {
      "description": "Search clinicians by name or specialty",
      "sql": "SELECT * FROM clinician_profiles WHERE user_id = $1 AND (full_name ILIKE $2 OR specialty ILIKE $2) ORDER BY created_at DESC"
    }
  },
  "edge_functions": {
    "count": 8,
    "list": [
      "ai-chat-router",
      "deepthink",
      "memory-lanes",
      "perplexity-search",
      "exercise-generator",
      "tutorial-generator",
      "reply-generator",
      "_shared"
    ],
    "deepthink": {
      "location": "supabase/functions/deepthink/",
      "entry_point": "index.ts",
      "size_kb": 16,
      "purpose": "Multi-pass reasoning orchestrator (planner → evidence → solvers → verifier)",
      "modules": {
        "index.ts": "Main orchestrator - coordinates pass execution",
        "evidence.ts": "RAG/retrieval - gathers evidence for queries",
        "verifier.ts": "Hybrid verification - validates solver outputs",
        "provider.ts": "Model abstraction - normalizes provider APIs",
        "cost.ts": "Cost calculation - tracks token usage and USD costs",
        "cache.ts": "Caching layer - SHA-256 keyed response cache",
        "metrics.ts": "Observability - logs and metrics collection",
        "validate.ts": "Schema validation - validates pass outputs",
        "util.ts": "Helper functions"
      },
      "schemas": {
        "location": "supabase/functions/deepthink/schemas/",
        "files": [
          "DeepThinkPlan.schema.json - Planner output schema",
          "DeepThinkDraft.schema.json - Solver output schema",
          "DeepThinkFinal.schema.json - Final output schema"
        ]
      }
    },
    "ai_chat_router": {
      "location": "supabase/functions/ai-chat-router/",
      "entry_point": "index.ts",
      "purpose": "Routes chat messages to appropriate lane or simple provider",
      "modules": {
        "index.ts": "Main router logic with SSE streaming",
        "searchRouter.ts": "Search-specific routing (Perplexity integration)"
      },
      "notes": "Returns SSE stream with events: text, metadata, done, error, debug"
    },
    "support_functions": {
      "memory_lanes": {
        "location": "supabase/functions/memory-lanes/",
        "purpose": "Memory system operations (store, retrieve, search)"
      },
      "perplexity_search": {
        "location": "supabase/functions/perplexity-search/",
        "purpose": "Web search integration via Perplexity API"
      },
      "exercise_generator": {
        "location": "supabase/functions/exercise-generator/",
        "purpose": "Generates learning exercises based on topics"
      },
      "tutorial_generator": {
        "location": "supabase/functions/tutorial-generator/",
        "purpose": "Creates tutorial content for learning mode"
      },
      "reply_generator": {
        "location": "supabase/functions/reply-generator/",
        "purpose": "Generates reply suggestions for clinician communication"
      }
    },
    "shared": {
      "_shared/cors.ts": "CORS headers for all functions"
    }
  },
  "frontend": {
    "location": "src/",
    "entry_point": "main.tsx → App.tsx",
    "file_counts": {
      "total_typescript_files": 121,
      "components": 50,
      "hooks": 15,
      "services": 10,
      "utilities": 20,
      "contexts": 3
    },
    "structure": {
      "components": {
        "key_interfaces": {
          "ChatInterface.tsx": "Main chat UI with streaming, image upload, model selection",
          "DeepThinkInterface.tsx": "Deep reasoning mode UI with pass visualization",
          "TutorialInterface.tsx": "Tutorial generation interface",
          "RecruiterDashboard.tsx": "Recruiter-specific dashboard",
          "ReplyAssistantInterface.tsx": "Reply generation interface"
        },
        "chat_components": [
          "MessageList.tsx - Message container with virtualization",
          "MessageBubble.tsx - Individual message display with markdown/code/HTML preview",
          "ChatInputArea.tsx - Message composition with file upload",
          "TypingIndicator.tsx - Streaming indicator (3 animated dots)"
        ],
        "artifacts": [
          "HTMLArtifact.tsx - HTML preview in sandboxed iframe",
          "MermaidArtifact.tsx - Diagram rendering",
          "OpenAPIArtifact.tsx - API spec viewer"
        ],
        "images": [
          "ImageGrid.tsx - Image gallery with responsive layout",
          "ImageLightbox.tsx - Full-screen image viewer",
          "ProgressiveImage.tsx - Progressive loading with blur-up"
        ]
      },
      "hooks": {
        "useAiRouterChat.ts": "Main chat orchestration hook with SSE streaming",
        "useDeepThink.ts": "DeepThink lane execution hook",
        "useChatSession.ts": "Session management and persistence",
        "useSupabaseData.ts": "Data fetching from Supabase",
        "useReplyAssistant.ts": "Reply generation for recruiting",
        "useEmailComposer.ts": "Email composition",
        "useLearningSystem.ts": "Learning/tutorial features",
        "useCodeSnippets.ts": "Code snippet library management",
        "useContextManager.ts": "Context resolution and management"
      },
      "contexts": {
        "ArtifactsContext.tsx": "Artifacts state management",
        "InputInjectionContext.tsx": "Input injection for templates",
        "ModeContext.tsx": "Interface mode management"
      },
      "lib": {
        "aiRouter.ts": "Client-side model routing logic",
        "supabaseClient.ts": "Supabase client configuration",
        "imageStorageService.ts": "Image upload/storage with compression",
        "documentUpload.ts": "Document handling",
        "documentRetrieval.ts": "Document retrieval",
        "contextResolver.ts": "Context resolution for prompts"
      },
      "services": {
        "contextService.ts": "Context management and token validation",
        "historyService.ts": "Chat history management",
        "memoryService.ts": "Memory system integration",
        "searchService.ts": "Search functionality (web + internal)"
      },
      "config": {
        "models.tsx": "Model configuration with provider keys and capabilities"
      }
    },
    "routes": {
      "concept": "Single-page app with mode-based interfaces",
      "modes": [
        "chat - Standard chat interface",
        "deepthink - Deep reasoning with lane visibility",
        "tutorial - Tutorial generation and learning",
        "recruiter - Recruiter dashboard view",
        "reply_assistant - Reply generation view"
      ]
    }
  },
  "ai_providers": {
    "anthropic": {
      "models": ["claude-3-5-sonnet-20240620"],
      "use_cases": ["Complex reasoning", "Code review", "Technical writing"],
      "vision_capable": true,
      "provider_key": "claude-3-5-sonnet-20240620"
    },
    "google": {
      "models": ["gemini-1.5-flash-latest", "gemini-2.5-pro", "gemini-2.5-flash"],
      "use_cases": ["Fast responses", "Multimodal tasks", "DeepThink passes"],
      "vision_capable": true,
      "provider_key": "gemini-1.5-flash-latest",
      "notes": "Gemini 1.5 Flash is primary model for production DeepThink lanes"
    },
    "openai": {
      "models": ["gpt-4o"],
      "use_cases": ["Balanced performance", "Creative tasks", "General chat"],
      "vision_capable": true,
      "provider_key": "gpt-4o"
    }
  },
  "routing_logic": {
    "router_function": "supabase/functions/ai-chat-router/index.ts",
    "strategy": "Analyze query → classify task type → select lane or simple provider → stream SSE response",
    "lane_selection_criteria": {
      "deepthink_triggers": [
        "Complex reasoning required",
        "Multi-step problem solving",
        "Evidence gathering needed",
        "High-stakes decisions"
      ],
      "simple_chat_triggers": [
        "Straightforward questions",
        "Creative writing",
        "Quick responses",
        "Conversational queries"
      ]
    },
    "model_routing_rules": {
      "self_awareness": "If query mentions specific model, route to that model",
      "task_based": "Match query pattern to model strengths",
      "user_preference": "Respect explicit model selection",
      "auto_fallback": "Default to auto router if uncertain"
    }
  },
  "observability": {
    "metrics": {
      "space_runs": "Total lane executions by status",
      "ai_runs": "Pass executions by type and model",
      "pass_failures": "Failure rate by pass type",
      "verify_score": "Verification quality scores (0-1 range)",
      "latency_p95": "95th percentile latency by pass",
      "cache_hit_rate": "Cache effectiveness percentage",
      "cost_by_user": "USD cost per user",
      "tokens_by_model": "Token usage by provider/model"
    },
    "logging": {
      "space_runs_table": "Complete job execution logs with final_output JSONB",
      "ai_runs_table": "Per-pass logs with input/output/tokens/latency",
      "ai_artifacts_table": "Evidence gathering logs with source attribution",
      "ai_run_checks_table": "Verification check results (pass/fail/skip)"
    },
    "automation": {
      "cache_purge": "Daily pg_cron job at 3 AM UTC - removes expired ai_cache entries",
      "partition_creation": "Monthly pg_cron job on 25th at 1 AM UTC - creates next month's ai_cost_ledger partition"
    }
  },
  "planned_verticals": {
    "builder": {
      "status": "planned",
      "description": "Code generation and IDE automation lanes - DO NOT IMPLEMENT WITHOUT EXPLICIT REQUEST",
      "planned_lanes": [
        {
          "name": "builder_translation",
          "purpose": "Normalize messy user intent into structured builder request"
        },
        {
          "name": "builder_spec",
          "purpose": "Turn normalized intent into feature specification"
        },
        {
          "name": "builder_sql",
          "purpose": "Generate schema and migrations from spec"
        },
        {
          "name": "builder_ui",
          "purpose": "Design screens, structure, and component map"
        },
        {
          "name": "builder_ui_polish",
          "purpose": "Microcopy, interactions, and styling"
        },
        {
          "name": "builder_patch",
          "purpose": "Generate concrete code patches per file"
        },
        {
          "name": "builder_debug",
          "purpose": "Diagnose failures and generate fix patches"
        }
      ]
    },
    "sports": {
      "status": "planned",
      "description": "Sports analytics and insights vertical - DO NOT IMPLEMENT WITHOUT EXPLICIT REQUEST"
    },
    "recruiting": {
      "status": "partially_implemented",
      "description": "Healthcare recruiting workflow automation",
      "implemented": [
        "RecruiterDashboard component",
        "clinician_profiles table",
        "assignments table",
        "clinician_communication_profiles table",
        "reply_threads table",
        "reply_messages table",
        "clinician_interactions table",
        "ReplyAssistantInterface for message generation",
        "reply-generator edge function"
      ]
    }
  },
  "security": {
    "rls_enabled": "All tables have Row Level Security enabled - NEVER disable",
    "policies": "Users can only access their own data (user_id FK check)",
    "service_role_bypass": "Edge functions use service role to bypass RLS for system operations",
    "auth_provider": "Supabase Auth with email/password",
    "image_storage": "Supabase Storage with signed URLs, RLS-protected buckets"
  },
  "performance": {
    "bundle_size": {
      "main_js": "334 KB (104 KB gzipped)",
      "chat_interface": "159 KB (48 KB gzipped)",
      "total_css": "87 KB (14 KB gzipped)"
    },
    "optimizations_implemented": [
      "Code splitting for lazy-loaded components (StorageManager, Modals)",
      "React.memo for MessageBubble and expensive components",
      "Streaming SSE responses for real-time updates",
      "Image compression before upload (browser-image-compression)",
      "SHA-256 keyed ai_cache for pass output caching"
    ],
    "optimizations_needed": [
      "Virtual scrolling for very long message lists (>100 messages)",
      "Request deduplication for concurrent identical queries",
      "More aggressive code splitting for syntax-highlighter"
    ],
    "caching_strategy": {
      "ai_cache_table": "SHA-256 keyed pass output cache",
      "ttl": "Configurable per lane (default 24 hours)",
      "invalidation": "Daily cron job purges expired entries at 3 AM UTC"
    }
  },
  "file_index": {
    "frontend_files": 121,
    "backend_functions": 8,
    "migration_files": 67,
    "total_loc_estimate": "~16000+ lines"
  }
}
